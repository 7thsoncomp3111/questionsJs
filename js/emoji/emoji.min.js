/*! Angular Emoji Popup  1.0.0 2014-12-26 */
"use strict";function checkDragEvent(e){if(!e||e.target&&("IMG"==e.target.tagName||"A"==e.target.tagName))return!1;if(!e.dataTransfer||!e.dataTransfer.types)return!0;for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1}function cancelEvent(e){return e=e||window.event,e&&(e=e.originalEvent||e,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1}var emojiApp=angular.module("emojiApp",["ngSanitize"]);emojiApp.config(["$sceProvider",function(e){e.enabled(!1);var t,i,n,o,r,s,a,l={},c={};for(i=0;i<Config.EmojiCategories.length;i++)for(a=Config.EmojiCategorySpritesheetDimens[i][1],t=0;t<Config.EmojiCategories[i].length;t++)o=Config.Emoji[Config.EmojiCategories[i][t]],n=o[1][0],r=Math.floor(t/a),s=t%a,l[":"+n+":"]=[i,r,s,":"+n+":"],c[n]=o[0];$.emojiarea.spritesheetPath="img/emojisprite_!.png",$.emojiarea.spritesheetDimens=Config.EmojiCategorySpritesheetDimens,$.emojiarea.iconSize=20,$.emojiarea.icons=l,$.emojiarea.reverseIcons=c}]),emojiApp.directive("contenteditable",["$sce",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,i,n){function o(){var e=t.html();i.stripBr&&"<br>"==e&&(e=""),n.$setViewValue(e)}n&&(n.$render=function(){t.html(n.$viewValue||"")},t.on("blur keyup change",function(){e.$evalAsync(o)}),o())}}}]),emojiApp.directive("emojiForm",["$timeout","$http","$interpolate","$compile",function(e,t,i,n){function o(t,o){function r(){}function s(){g&&($(g).trigger("change"),a())}function a(){var e=g.offsetHeight;b!=e&&(b=e,t.$emit("ui_editor_resize"))}function l(e){var i=(e.originalEvent||e).target,n=(i||{}).src||"",o=!1;if("data:"==n.substr(0,5)){o=!0;var r=dataUrlToBlob(n);ErrorService.confirm({type:"FILE_CLIPBOARD_PASTE"}).then(function(){t.draftMessage.files=[r],t.draftMessage.isMedia=!0}),setZeroTimeout(function(){i.parentNode.removeChild(i)})}else if(n&&!n.match(/img\/blank\.gif/)){var s=document.createTextNode(" "+n+" ");setTimeout(function(){i.parentNode.replaceChild(s,i)},100)}}function c(e){console.log("onPasteEvent");var i,n,o=(e.originalEvent||e).clipboardData,r=o&&o.items||[],s=[];for(n=0;n<r.length;n++)"file"==r[n].kind&&(i=r[n].getAsFile(),s.push(i));s.length>0&&ErrorService.confirm({type:"FILES_CLIPBOARD_PASTE",files:s}).then(function(){t.draftMessage.files=s,t.draftMessage.isMedia=!0})}function h(e){return 9!=e.keyCode||e.shiftKey||e.ctrlKey||e.metaKey||$modalStack.getTop()?void 0:(f.focus(),cancelEvent(e))}var u=$("textarea",o)[0],p=$("input",o),d=$("#emojibtn",o)[0],f=u,g=($(u).emojiarea({button:d,norealTime:!0}),$(".emoji-menu",o)[0],$(".emoji-wysiwyg-editor",o)[0]),m=n($("#messageDiv"));if($("#messageDiv").replaceWith(m(t)),g){f=g,$(g).attr("placeholder",i($(u).attr("placeholder"))(t));var v;$(g).on("DOMNodeInserted",l).on("keyup",function(){a(),S||t.$apply(function(){t.emojiMessage.messagetext=g.textContent}),e.cancel(v),v=e(s,1e3)})}var y=!0;$(f).on("keydown",function(i){if(g&&a(),13==i.keyCode){var n=!1;if(y&&!i.shiftKey?n=!0:y||!i.ctrlKey&&!i.metaKey||(n=!0),n)return e.cancel(v),s(),t.emojiMessage.replyToUser(),r(),cancelEvent(i)}});$(document).on("keydown",h),$(document).on("paste",c);var S=!1;t.$on("$destroy",function(){$(document).off("paste",c),$(document).off("keydown",h),$(submitBtn).off("mousedown"),p.off("change"),g&&$(g).off("DOMNodeInserted keyup",l),$(f).off("keydown")})}return{scope:{emojiMessage:"="},link:o}}]),emojiApp.filter("colonToCode",function(){return function(e){return e?(Config.rx_colons||Config.init_unified(),e.replace(Config.rx_colons,function(e){var t=Config.mapcolon[e];return t?t:""})):""}}),emojiApp.filter("codeToSmiley",function(){return function(e){return e?(Config.rx_codes||Config.init_unified(),e.replace(Config.rx_codes,function(e){var t=Config.reversemap[e];if(t){t=":"+t+":";var i=$.emojiarea.createIcon($.emojiarea.icons[t]);return i}return""})):""}}),emojiApp.filter("colonToSmiley",function(){return function(e){return e?(Config.rx_colons||Config.init_unified(),e.replace(Config.rx_colons,function(e){if(e){var t=$.emojiarea.createIcon($.emojiarea.icons[e]);return t}return""})):""}}),function(e){function t(e){a=e}function i(){l=!0}function n(){return l?(l=!1,""):a}function o(){var e,t,i,o=Array.prototype.slice.call(arguments),r=o.pop(),s=[],a=1==o.length,l=!0,p=n();for(t=0;t<o.length;t++)if(i=o[t]=p+o[t],"xt_"!=i.substr(0,3)&&void 0!==c[i])s.push(c[i]);else if(u){try{e=localStorage.getItem(i)}catch(d){u=!1}try{e=void 0===e||null===e?!1:JSON.parse(e)}catch(d){e=!1}s.push(c[i]=e)}else h?l=!1:s.push(c[i]=!1);return l?r(a?s[0]:s):void chrome.storage.local.get(o,function(e){var n;for(s=[],t=0;t<o.length;t++)i=o[t],n=e[i],n=void 0===n||null===n?!1:JSON.parse(n),s.push(c[i]=n);r(a?s[0]:s)})}function r(e,t){var i,o,r={},s=n();for(i in e)if(e.hasOwnProperty(i))if(o=e[i],i=s+i,c[i]=o,o=JSON.stringify(o),u)try{localStorage.setItem(i,o)}catch(a){u=!1}else r[i]=o;return u||!h?void(t&&t()):void chrome.storage.local.set(r,t)}function s(){var e,t,i,o=Array.prototype.slice.call(arguments),r=n();for("function"==typeof o[o.length-1]&&(i=o.pop()),e=0;e<o.length;e++)if(t=o[e]=r+o[e],delete c[t],u)try{localStorage.removeItem(t)}catch(s){u=!1}h?chrome.storage.local.remove(o,i):i&&i()}var a="",l=!1,c={},h=!!(e.chrome&&chrome.storage&&chrome.storage.local),u=!h&&!!e.localStorage;e.ConfigStorage={prefix:t,noPrefix:i,get:o,set:r,remove:s}}(this),function(e,t,i){var n=1,o=3,r=["p","div","pre","form"],s=27,a=9;e.emojiarea={path:"",spritesheetPath:"",spritesheetDimens:[],iconSize:20,icons:{},defaults:{button:null,buttonLabel:"Emojis",buttonPosition:"after"}};var l=":joy:,:kissing_heart:,:heart:,:heart_eyes:,:blush:,:grin:,:+1:,:relaxed:,:pensive:,:smile:,:sob:,:kiss:,:unamused:,:flushed:,:stuck_out_tongue_winking_eye:,:see_no_evil:,:wink:,:smiley:,:cry:,:stuck_out_tongue_closed_eyes:,:scream:,:rage:,:smirk:,:disappointed:,:sweat_smile:,:kissing_closed_eyes:,:speak_no_evil:,:relieved:,:grinning:,:yum:,:laughing:,:ok_hand:,:neutral_face:,:confused:".split(",");e.fn.emojiarea=function(t){return t=e.extend({},e.emojiarea.defaults,t),this.each(function(){var n=e(this);"contentEditable"in i.body&&t.wysiwyg!==!1?new p(n,t):new u(n,t)})};var c={};c.restoreSelection=function(){return t.getSelection?function(e){var i=t.getSelection();i.removeAllRanges();for(var n=0,o=e.length;o>n;++n)i.addRange(e[n])}:i.selection&&i.selection.createRange?function(e){e&&e.select()}:void 0}(),c.saveSelection=function(){return t.getSelection?function(){var e=t.getSelection(),i=[];if(e.rangeCount)for(var n=0,o=e.rangeCount;o>n;++n)i.push(e.getRangeAt(n));return i}:i.selection&&i.selection.createRange?function(){var e=i.selection;return"none"!==e.type.toLowerCase()?e.createRange():null}:void 0}(),c.replaceSelection=function(){return t.getSelection?function(e){var n,o=t.getSelection(),r="string"==typeof e?i.createTextNode(e):e;o.getRangeAt&&o.rangeCount&&(n=o.getRangeAt(0),n.deleteContents(),n.insertNode(i.createTextNode(" ")),n.insertNode(r),n.setStart(r,0),t.setTimeout(function(){n=i.createRange(),n.setStartAfter(r),n.collapse(!0),o.removeAllRanges(),o.addRange(n)},0))}:i.selection&&i.selection.createRange?function(e){var t=i.selection.createRange();"string"==typeof e?t.text=e:t.pasteHTML(e.outerHTML)}:void 0}(),c.insertAtCursor=function(e,t){e=" "+e;var n,o,r,s=t.value;void 0!==t.selectionStart&&void 0!==t.selectionEnd?(o=t.selectionStart,n=t.selectionEnd,t.value=s.substring(0,o)+e+s.substring(t.selectionEnd),t.selectionStart=t.selectionEnd=o+e.length):void 0!==i.selection&&void 0!==i.selection.createRange&&(t.focus(),r=i.selection.createRange(),r.text=e,r.select())},c.extend=function(e,t){if(void 0!==e&&e||(e={}),"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},c.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},c.htmlEntities=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},c.emojiInserted=function(e){ConfigStorage.get("emojis_recent",function(t){t=t||l||[];var i=t.indexOf(e);return i?(-1!=i&&t.splice(i,1),t.unshift(e),t.length>42&&(t=t.slice(42)),void ConfigStorage.set({emojis_recent:t})):!1})};var h=function(){};h.prototype.setup=function(){var e=this;this.$editor.on("focus",function(){e.hasFocus=!0}),this.$editor.on("blur",function(){e.hasFocus=!1}),this.setupButton()},h.prototype.setupButton=function(){var t,i=this;this.options.button?t=e(this.options.button):this.options.button!==!1?(t=e('<a href="javascript:void(0)">'),t.html(this.options.buttonLabel),t.addClass("emoji-button"),t.attr({title:this.options.buttonLabel}),this.$editor[this.options.buttonPosition](t)):t=e(""),t.on("click",function(e){d.show(i),e.stopPropagation()}),this.$button=t},h.createIcon=function(t,i){var n=t[0],o=t[1],r=t[2],s=t[3],a=e.emojiarea.spritesheetPath,l=i&&Config.Mobile?26:e.emojiarea.iconSize,h=-(l*r),u=-(l*o),p=e.emojiarea.spritesheetDimens[n][1]*l,d=e.emojiarea.spritesheetDimens[n][0]*l,f="display:inline-block;";return f+="width:"+l+"px;",f+="height:"+l+"px;",f+="background:url('"+a.replace("!",n)+"') "+h+"px "+u+"px no-repeat;",f+="background-size:"+p+"px "+d+"px;",'<img src="img/blank.gif" class="img" style="'+f+'" alt="'+c.htmlEntities(s)+'">'},e.emojiarea.createIcon=h.createIcon;var u=function(e,t){this.options=t,this.$textarea=e,this.$editor=e,this.setup()};u.prototype.insert=function(t){e.emojiarea.icons.hasOwnProperty(t)&&(c.insertAtCursor(t,this.$textarea[0]),c.emojiInserted(t,this.menu),this.$textarea.trigger("change"))},u.prototype.val=function(){return this.$textarea.val()},c.extend(u.prototype,h.prototype);var p=function(t,n){var o=this;this.options=n||{},this.$textarea=t,this.$editor=e("<div>").addClass("q-input").addClass("rseparator"),this.$editor.text(t.val()),this.$editor.attr({contenteditable:"true",id:"new-todo",text:"Ask a Question...","ng-model":"emojiMessage.rawhtml"});var r="blur change";this.options.norealTime||(r+=" keyup"),this.$editor.on(r,function(e){return o.onChange.apply(o,[e])}),this.$editor.on("paste",function(e){return o.onPaste.apply(o,[e])}),this.$editor.on("mousedown focus",function(){i.execCommand("enableObjectResizing",!1,!1)}),this.$editor.on("blur",function(){i.execCommand("enableObjectResizing",!0,!0)});var s=this.$editor.text(),a=e.emojiarea.icons;for(var l in a)a.hasOwnProperty(l)&&(s=s.replace(RegExp(c.escapeRegex(l),"g"),h.createIcon(a[l])));this.$editor.html(s),t.hide().after(this.$editor),this.setup(),e(i.body).on("mousedown",function(){o.hasFocus&&(o.selection=c.saveSelection())})};p.prototype.onPaste=function(e){var t,n=(e.originalEvent||e).clipboardData,o=n&&n.items||[];for(t=0;t<o.length;t++)if("file"==o[t].kind)return e.preventDefault(),!0;var r=(e.originalEvent||e).clipboardData.getData("text/plain"),s=this;return setTimeout(function(){s.onChange()},0),r.length?(i.execCommand("insertText",!1,r),cancelEvent(e)):!0},p.prototype.onChange=function(){this.$textarea.val(this.val()).trigger("change")},p.prototype.insert=function(t){var i=e(h.createIcon(e.emojiarea.icons[t]));i[0].attachEvent&&i[0].attachEvent("onresizestart",function(e){e.returnValue=!1},!1),this.$editor.trigger("focus"),this.selection&&c.restoreSelection(this.selection);try{c.replaceSelection(i[0])}catch(n){}c.emojiInserted(t,this.menu),this.onChange()},p.prototype.val=function(){for(var e=[],t=[],i=function(){e.push(t.join("")),t=[]},s=function(e){if(e.nodeType===o)t.push(e.nodeValue);else if(e.nodeType===n){var a=e.tagName.toLowerCase(),l=-1!==r.indexOf(a);if(l&&t.length&&i(),"img"===a){var c=e.getAttribute("alt")||"";return void(c&&t.push(c))}"br"===a&&i();for(var h=e.childNodes,u=0;u<h.length;u++)s(h[u]);l&&t.length&&i()}},a=this.$editor[0].childNodes,l=0;l<a.length;l++)s(a[l]);return t.length&&i(),e.join("\n")},c.extend(p.prototype,h.prototype);var d=function(){var n=this,o=e(i.body),r=e(t);this.visible=!1,this.emojiarea=null,this.$menu=e("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.hide(),this.$itemsTailWrap=e('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu),this.$categoryTabs=e('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap),this.$itemsWrap=e('<div class="emoji-items-wrap nano mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap),this.$items=e('<div class="emoji-items nano-content">').appendTo(this.$itemsWrap),o.append(this.$menu),Config.Mobile||this.$itemsWrap.nanoScroller({preventPageScrolling:!0,tabIndex:-1}),o.on("keydown",function(e){(e.keyCode===s||e.keyCode===a)&&n.hide()}),o.on("message_send",function(){n.hide()}),o.on("mouseup",function(e){e=e.originalEvent||e;for(var i=e.originalTarget||e.target||t;i&&i!=t;)if(i=i.parentNode,i==n.$menu[0]||n.emojiarea&&i==n.emojiarea.$button[0])return;n.hide()}),r.on("resize",function(){n.visible&&n.reposition()}),this.$menu.on("mouseup","a",function(e){return e.stopPropagation(),!1}),this.$menu.on("click","a",function(i){if(e(this).hasClass("emoji-menu-tab"))return n.getTabIndex(this)!==n.currentCategory&&n.selectCategory(n.getTabIndex(this)),!1;var o=e(".label",e(this)).text();return t.setTimeout(function(){n.onItemSelected(o),(i.ctrlKey||i.metaKey)&&n.hide()},0),i.stopPropagation(),!1}),this.selectCategory(0)};d.prototype.getTabIndex=function(e){return this.$categoryTabs.find(".emoji-menu-tab").index(e)},d.prototype.selectCategory=function(e){this.$categoryTabs.find(".emoji-menu-tab").each(function(t){t===e?this.className+="-selected":this.className=this.className.replace("-selected","")}),this.currentCategory=e,this.load(e),Config.Mobile||this.$itemsWrap.nanoScroller({scroll:"top"})},d.prototype.onItemSelected=function(e){this.emojiarea.insert(e)},d.prototype.load=function(t){var i=[],n=e.emojiarea.icons,o=e.emojiarea.path,r=this;o.length&&"/"!==o.charAt(o.length-1)&&(o+="/");var s=function(){r.$items.html(i.join("")),Config.Mobile||setTimeout(function(){r.$itemsWrap.nanoScroller()},100)};if(t>0){for(var a in n)n.hasOwnProperty(a)&&n[a][0]===t-1&&i.push('<a href="javascript:void(0)" title="'+c.htmlEntities(a)+'">'+h.createIcon(n[a],!0)+'<span class="label">'+c.htmlEntities(a)+"</span></a>");s()}else ConfigStorage.get("emojis_recent",function(e){e=e||l||[];var t,o;for(o=0;o<e.length;o++)t=e[o],n[t]&&i.push('<a href="javascript:void(0)" title="'+c.htmlEntities(t)+'">'+h.createIcon(n[t],!0)+'<span class="label">'+c.htmlEntities(t)+"</span></a>");s()})},d.prototype.reposition=function(){var e=this.emojiarea.$button,t=e.offset();t.top+=e.outerHeight(),t.left+=Math.round(e.outerWidth()/2),this.$menu.css({top:t.top,left:t.left})},d.prototype.hide=function(){this.emojiarea&&(this.emojiarea.menu=null,this.emojiarea.$button.removeClass("on"),this.emojiarea=null),this.visible=!1,this.$menu.hide("fast")},d.prototype.show=function(e){return this.emojiarea&&this.emojiarea===e?this.hide():(e.$button.addClass("on"),this.emojiarea=e,this.emojiarea.menu=this,this.reposition(),this.$menu.show("fast"),this.currentCategory||this.load(0),void(this.visible=!0))},d.show=function(){var e=null;return function(t){e=e||new d,e.show(t)}}()}(jQuery,window,document),function(e,t,i){var n,o,r,s,a,l,c,h,u,p,d,f,g,m,v,y,$,b,S,T,j,C,x,w,E,A,k,_,O,M,H;x={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},b="scrollbar",$="scroll",u="mousedown",p="mouseenter",d="mousemove",g="mousewheel",f="mouseup",y="resize",a="drag",l="enter",T="up",v="panedown",r="DOMMouseScroll",s="down",j="wheel",c="keydown",h="keyup",S="touchmove",n="Microsoft Internet Explorer"===t.navigator.appName&&/msie 7./i.test(t.navigator.appVersion)&&t.ActiveXObject,o=null,k=t.requestAnimationFrame,C=t.cancelAnimationFrame,O=i.createElement("div").style,H=function(){var e,t,i,n,o,r;for(n=["t","webkitT","MozT","msT","OT"],e=o=0,r=n.length;r>o;e=++o)if(i=n[e],t=n[e]+"ransform",t in O)return n[e].substr(0,n[e].length-1);return!1}(),M=function(e){return H===!1?!1:""===H?e:H+e.charAt(0).toUpperCase()+e.substr(1)},_=M("transform"),E=_!==!1,w=function(){var e,t,n;return e=i.createElement("div"),t=e.style,t.position="absolute",t.width="100px",t.height="100px",t.overflow=$,t.top="-9999px",i.body.appendChild(e),n=e.offsetWidth-e.clientWidth,i.body.removeChild(e),n},A=function(){var e,i,n;return i=t.navigator.userAgent,(e=/(?=.+Mac OS X)(?=.+Firefox)/.test(i))?(n=/Firefox\/\d{2}\./.exec(i),n&&(n=n[0].replace(/\D+/g,"")),e&&+n>23):!1},m=function(){function c(n,r){this.el=n,this.options=r,o||(o=w()),this.$el=e(this.el),this.doc=e(this.options.documentContext||i),this.win=e(this.options.windowContext||t),this.body=this.doc.find("body"),this.$content=this.$el.children("."+r.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.previousPosition=0,this.options.iOSNativeScrolling&&(null!=this.el.style.WebkitOverflowScrolling||navigator.userAgent.match(/mobi.+Gecko/i))?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return c.prototype.preventScrolling=function(e,t){if(this.isActive)if(e.type===r)(t===s&&e.originalEvent.detail>0||t===T&&e.originalEvent.detail<0)&&e.preventDefault();else if(e.type===g){if(!e.originalEvent||!e.originalEvent.wheelDelta)return;(t===s&&e.originalEvent.wheelDelta<0||t===T&&e.originalEvent.wheelDelta>0)&&e.preventDefault()}},c.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},c.prototype.updateScrollValues=function(){var e,t;e=this.content,this.maxScrollTop=e.scrollHeight-e.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=e.scrollTop,t=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same",this.previousPosition=this.contentScrollTop,"same"!==t&&this.$el.trigger("update",{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:t}),this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},c.prototype.setOnScrollStyles=function(){var e;E?(e={},e[_]="translate(0, "+this.sliderTop+"px)"):e={top:this.sliderTop},k?(C&&this.scrollRAF&&C(this.scrollRAF),this.scrollRAF=k(function(t){return function(){return t.scrollRAF=null,t.slider.css(e)}}(this))):this.slider.css(e)},c.prototype.createEvents=function(){this.events={down:function(e){return function(t){return e.isBeingDragged=!0,e.offsetY=t.pageY-e.slider.offset().top,e.slider.is(t.target)||(e.offsetY=0),e.pane.addClass("active"),e.doc.bind(d,e.events[a]).bind(f,e.events[T]),e.body.bind(p,e.events[l]),!1}}(this),drag:function(e){return function(t){return e.sliderY=t.pageY-e.$el.offset().top-e.paneTop-(e.offsetY||.5*e.sliderHeight),e.scroll(),e.contentScrollTop<e.maxScrollTop||e.prevScrollTop===e.maxScrollTop?0===e.contentScrollTop&&0!==e.prevScrollTop&&e.$el.trigger("scrolltop"):e.$el.trigger("scrollend"),!1}}(this),up:function(e){return function(){return e.isBeingDragged=!1,e.pane.removeClass("active"),e.doc.unbind(d,e.events[a]).unbind(f,e.events[T]),e.body.unbind(p,e.events[l]),!1}}(this),resize:function(e){return function(){e.reset()}}(this),panedown:function(e){return function(t){return e.sliderY=(t.offsetY||t.originalEvent.layerY)-.5*e.sliderHeight,e.scroll(),e.events.down(t),!1}}(this),scroll:function(e){return function(t){e.updateScrollValues(),e.isBeingDragged||(e.iOSNativeScrolling||(e.sliderY=e.sliderTop,e.setOnScrollStyles()),null!=t&&(e.contentScrollTop<e.maxScrollTop?0===e.contentScrollTop&&(e.options.preventPageScrolling&&e.preventScrolling(t,T),0!==e.prevScrollTop&&e.$el.trigger("scrolltop")):(e.options.preventPageScrolling&&e.preventScrolling(t,s),e.prevScrollTop!==e.maxScrollTop&&e.$el.trigger("scrollend"))))}}(this),wheel:function(e){return function(t){var i;return null!=t?(i=t.delta||t.wheelDelta||t.originalEvent&&t.originalEvent.wheelDelta||-t.detail||t.originalEvent&&-t.originalEvent.detail,i&&(e.sliderY+=-i/3),e.scroll(),!1):void 0}}(this),enter:function(e){return function(t){var i;return e.isBeingDragged&&1!==(t.buttons||t.which)?(i=e.events)[T].apply(i,arguments):void 0}}(this)}},c.prototype.addEvents=function(){var e;this.removeEvents(),e=this.events,this.options.disableResize||this.win.bind(y,e[y]),this.iOSNativeScrolling||(this.slider.bind(u,e[s]),this.pane.bind(u,e[v]).bind(""+g+" "+r,e[j])),this.$content.bind(""+$+" "+g+" "+r+" "+S,e[$])},c.prototype.removeEvents=function(){var e;e=this.events,this.win.unbind(y,e[y]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(""+$+" "+g+" "+r+" "+S,e[$])},c.prototype.generate=function(){var e,i,n,r,s,a,l;return r=this.options,a=r.paneClass,l=r.sliderClass,e=r.contentClass,(s=this.$el.children("."+a)).length||s.children("."+l).length||this.$el.append('<div class="'+a+'"><div class="'+l+'" /></div>'),this.pane=this.$el.children("."+a),this.slider=this.pane.find("."+l),0===o&&A()?(n=t.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/[^0-9.]+/g,""),i={right:-14,paddingRight:+n+14}):o&&(i={right:-o},this.$el.addClass("has-scrollbar")),null!=i&&this.$content.css(i),this},c.prototype.restore=function(){this.stopped=!1,this.iOSNativeScrolling||this.pane.show(),this.addEvents()},c.prototype.reset=function(){var e,t,i,r,s,a,l,c,h,u,p,d;return this.iOSNativeScrolling?void(this.contentHeight=this.content.scrollHeight):(this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),e=this.content,r=e.style,s=r.overflowY,n&&this.$content.css({height:this.$content.height()}),t=e.scrollHeight+o,u=parseInt(this.$el.css("max-height"),10),u>0&&(this.$el.height(""),this.$el.height(e.scrollHeight>u?u:e.scrollHeight)),l=this.pane.outerHeight(!1),h=parseInt(this.pane.css("top"),10),a=parseInt(this.pane.css("bottom"),10),c=l+h+a,d=Math.round(c/t*c),d<this.options.sliderMinHeight?d=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&d>this.options.sliderMaxHeight&&(d=this.options.sliderMaxHeight),s===$&&r.overflowX!==$&&(d+=o),this.maxSliderTop=c-d,this.contentHeight=t,this.paneHeight=l,this.paneOuterHeight=c,this.sliderHeight=d,this.paneTop=h,this.slider.height(d),this.events.scroll(),this.pane.show(),this.isActive=!0,e.scrollHeight===e.clientHeight||this.pane.outerHeight(!0)>=e.scrollHeight&&s!==$?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===e.scrollHeight&&s===$?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),i=this.$content.css("position"),("static"===i||"relative"===i)&&(p=parseInt(this.$content.css("right"),10),p&&this.$content.css({right:"",marginRight:p})),this)},c.prototype.scroll=function(){return this.isActive?(this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop),this.iOSNativeScrolling||(this.updateScrollValues(),this.setOnScrollStyles()),this):void 0},c.prototype.scrollBottom=function(e){return this.isActive?(this.$content.scrollTop(this.contentHeight-this.$content.height()-e).trigger(g),this.stop().restore(),this):void 0},c.prototype.scrollTop=function(e){return this.isActive?(this.$content.scrollTop(+e).trigger(g),this.stop().restore(),this):void 0},c.prototype.scrollTo=function(e){return this.isActive?(this.scrollTop(this.$el.find(e).get(0).offsetTop),this):void 0},c.prototype.stop=function(){return C&&this.scrollRAF&&(C(this.scrollRAF),this.scrollRAF=null),this.stopped=!0,this.removeEvents(),this.iOSNativeScrolling||this.pane.hide(),this},c.prototype.destroy=function(){return this.stopped||this.stop(),!this.iOSNativeScrolling&&this.pane.length&&this.pane.remove(),n&&this.$content.height(""),this.$content.removeAttr("tabindex"),this.$el.hasClass("has-scrollbar")&&(this.$el.removeClass("has-scrollbar"),this.$content.css({right:""})),this},c.prototype.flash=function(){return!this.iOSNativeScrolling&&this.isActive?(this.reset(),this.pane.addClass("flashed"),setTimeout(function(e){return function(){e.pane.removeClass("flashed")}}(this),this.options.flashDelay),this):void 0},c}(),e.fn.nanoScroller=function(t){return this.each(function(){var i,n;if((n=this.nanoscroller)||(i=e.extend({},x,t),this.nanoscroller=n=new m(this,i)),t&&"object"==typeof t){if(e.extend(n.options,t),null!=t.scrollBottom)return n.scrollBottom(t.scrollBottom);if(null!=t.scrollTop)return n.scrollTop(t.scrollTop);if(t.scrollTo)return n.scrollTo(t.scrollTo);if("bottom"===t.scroll)return n.scrollBottom(0);if("top"===t.scroll)return n.scrollTop(0);if(t.scroll&&t.scroll instanceof e)return n.scrollTo(t.scroll);if(t.stop)return n.stop();if(t.destroy)return n.destroy();if(t.flash)return n.flash()}return n.reset()})},e.fn.nanoScroller.Constructor=m}(jQuery,window,document);
